<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Google Apps Script</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  </head>

  <body>
    <div id="myContainer" class="container">
      <div class="row">
        <div class="col s12 m6">
          <div class="card blue-grey darken-1">
            <div class="card-content white-text">
              <span class="card-title">Full Stack Academy</span>
              <p id="banner">Please select an option</p>
            </div>
          </div>
        </div>
      </div>
      <div id="select" class="row">
        <label id="label">Select one</label>
        <select id="role" class="browser-default">
          <option value="" disabled selected>I am a...</option>
          <option value="1">Student</option>
          <option value="2">Instructor</option>
        </select>
        <button id="btn">Submit</button>
      </div>
    </div>

    <script>
      const button = document.getElementById('btn').addEventListener('click', generateForm);

      const submitForm = () => {
        console.log('hi');
      };

      function generateForm() {
        // This function runs a user clicks btn as role 'Student' or 'Instructor'
        let mySelect = document.getElementById('role').value;

        document.getElementById('role').style.display = 'none';
        document.getElementById('btn').style.display = 'none';

        const outerContainer = document.getElementById('select');
        const label = document.getElementById('banner');
        const topLabel = document.getElementById('label');

        topLabel.style.display = 'none';

        // User selects "Student"
        if (mySelect === '1') {
          // Banner text
          label.innerText = 'Please enter your feedback';

          // Create container DIVs
          const nameDiv = document.createElement('DIV');
          const workshopDiv = document.createElement('DIV');
          const instructorDiv = document.createElement('DIV');
          const cohortDiv = document.createElement('DIV');
          const rateLectureDiv = document.createElement('DIV');
          const rateMaterialDiv = document.createElement('DIV');
          const rateReviewDiv = document.createElement('DIV');
          const improvementDiv = document.createElement('DIV');

          // Create text inputs, selects, and labels
          const nameInput = document.createElement('INPUT');
          const nameLabel = document.createElement('LABEL');
          const workshopInput = document.createElement('INPUT');
          const workshopLabel = document.createElement('LABEL');
          const instructorInput = document.createElement('INPUT');
          const instructorLabel = document.createElement('LABEL');
          const cohortInput = document.createElement('INPUT');
          const cohortLabel = document.createElement('LABEL');
          const rateLectureLabel = document.createElement('LABEL');
          const rateLectureSelect = document.createElement('SELECT');
          const rateMaterialLabel = document.createElement('LABEL');
          const rateMaterialSelect = document.createElement('SELECT');
          const rateReviewLabel = document.createElement('LABEL');
          const rateReviewSelect = document.createElement('SELECT');
          const improvementText = document.createElement('TEXTAREA');
          const improvementLabel = document.createElement('LABEL');

          // Create Submit button
          const btn = document.createElement('BUTTON');
          btn.innerHTML = 'Submit';
          btn.setAttribute('id', 'submitBtn');
          
          // Select elements that need options
          const list = [rateLectureSelect, rateMaterialSelect, rateReviewSelect];

          // Loop to generate options 0-5
          list.forEach((select) => {
            for (let i = 0; i <= 5; i++) {
              let opt = document.createElement('option');
              opt.value = i;
              opt.innerHTML = i;
              select.appendChild(opt);
            }
          });

          // Add attributes to generated DOM Elements
          // Add `material-ui` classes to divs
          nameDiv.classList.add('input-field', 'col', 's6');
          workshopDiv.classList.add('input-field', 'col', 's6');
          instructorDiv.classList.add('input-field', 'col', 's6');
          cohortDiv.classList.add('input-field', 'col', 's6');
          rateLectureSelect.classList.add('browser-default');
          rateMaterialSelect.classList.add('browser-default');
          rateReviewSelect.classList.add('browser-default');

          // Add text types to inputs
          nameInput.setAttribute('type', 'text');
          workshopInput.setAttribute('type', 'text');
          instructorInput.setAttribute('type', 'text');
          cohortInput.setAttribute('type', 'text');

          // Add id to input and select elements
          nameInput.setAttribute('id', 'nameInput');
          workshopInput.setAttribute('id', 'workshopInput');
          instructorInput.setAttribute('id', 'instructorInput');
          cohortInput.setAttribute('id', 'cohortInput');
          rateLectureSelect.setAttribute('id', 'rateLectureSelect');
          rateMaterialSelect.setAttribute('id', 'rateMaterialSelect');
          rateReviewSelect.setAttribute('id', 'rateReviewSelect');
          improvementText.setAttribute('id', 'improvementText');

          // Add inner text to labels
          nameLabel.innerText = 'Your Name';
          workshopLabel.innerText = 'Workshop Name';
          instructorLabel.innerText = 'Instructor Name';
          cohortLabel.innerText = 'Cohort';
          rateLectureLabel.innerText = 'How was the lecture for this workshop (if applicable)?';
          rateMaterialLabel.innerText = 'How was the workshop material for this workshop?';
          rateReviewLabel.innerText = 'How was the review for this workshop (if applicable)';
          improvementLabel.innerText = 'How would you improve the workshop?';

          // Append created and formatted elements to DOM
          outerContainer.appendChild(nameDiv);
          nameDiv.appendChild(nameInput);
          nameDiv.appendChild(nameLabel);

          outerContainer.appendChild(workshopDiv);
          workshopDiv.appendChild(workshopInput);
          workshopDiv.appendChild(workshopLabel);

          outerContainer.appendChild(instructorDiv);
          instructorDiv.appendChild(instructorInput);
          instructorDiv.appendChild(instructorLabel);

          outerContainer.appendChild(cohortDiv);
          cohortDiv.appendChild(cohortInput);
          cohortDiv.appendChild(cohortLabel);

          outerContainer.appendChild(rateLectureDiv);
          rateLectureDiv.appendChild(rateLectureLabel);
          rateLectureDiv.appendChild(rateLectureSelect);

          outerContainer.appendChild(rateMaterialDiv);
          rateMaterialDiv.appendChild(rateMaterialLabel);
          rateMaterialDiv.appendChild(rateMaterialSelect);

          outerContainer.appendChild(rateReviewDiv);
          rateReviewDiv.appendChild(rateReviewLabel);
          rateReviewDiv.appendChild(rateReviewSelect);

          outerContainer.appendChild(improvementDiv);
          improvementDiv.appendChild(improvementLabel);
          improvementDiv.appendChild(improvementText);

          outerContainer.appendChild(btn);

          // User selects "Instructor"
        } else {
          label.innerText = 'Please enter your response';
        }

        document.getElementById('submitBtn').addEventListener('click', submitForm);

        function submitForm() {
          // Caputre form values
          const name = document.getElementById('nameInput').value;
          const workshop = document.getElementById('workshopInput').value;
          const instructor = document.getElementById('instructorInput').value;
          const cohort = document.getElementById('cohortInput').value;
          const lectureRating = document.getElementById('rateLectureSelect').value;
          const materialRating = document.getElementById('rateMaterialSelect').value;
          const reviewRating = document.getElementById('rateReviewSelect').value;
          const improve = document.getElementById('improvementText').value;
          console.log(
            name,
            workshop,
            instructor,
            cohort,
            lectureRating,
            materialRating,
            reviewRating,
            improve
          );

          google.script.run.submitCode(
            name,
            workshop,
            instructor,
            cohort,
            lectureRating,
            materialRating,
            reviewRating,
            improve,
            new Date()
          );
        }
        function submitCode(
          name,
          workshop,
          instructor,
          cohort,
          lectureRating,
          materialRating,
          reviewRating,
          improve
        ) {
          // Google Sheets Connection
          const url =
            'https://docs.google.com/spreadsheets/d/1JHWN0PvhFJno-hjLj_uye42FUTQr8FeCNdj5TmLxD0Y/edit#gid=0';
          const googleSheet = SpreadsheetApp.openByUrl(url);
          const sheet1 = googleSheet.getSheetByName('Sheet1');
          sheet1.appendRow([
            name,
            workshop,
            instructor,
            cohort,
            lectureRating,
            materialRating,
            reviewRating,
            improve,
            new Date(),
          ]);
        }
      }
    </script>
  </body>
</html>
